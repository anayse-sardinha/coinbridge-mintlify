{
  "openapi": "3.0.3",
  "info": {
    "title": "CoinBridge Application Back-End API",
    "description": "This API is used by the CoinBridge system to interact with the application's back-end for user validation, balance fetching, spending policies, and transaction processing.",
    "version": "1.0.0"
  },
  "paths": {
    "/coinbridge/api/v1/user/{userId}/details": {
      "get": {
        "summary": "End-User Details Fetch",
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EndUserDetailsDTO"
                }
              }
            }
          }
        }
      }
    },
    "/coinbridge/api/v1/user/{userId}/balance": {
      "get": {
        "summary": "End-User Balance Fetch",
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EndUserBalanceDTO"
                }
              }
            }
          }
        }
      }
    },
    "/coinbridge/api/v1/user/{userId}/rules": {
      "get": {
        "summary": "End-User Spending Policy Fetch",
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EndUserRulesDTO"
                }
              }
            }
          }
        }
      }
    },
    "/coinbridge/api/v2/authorize": {
      "post": {
        "summary": "Transaction Authorization",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TransactionAuthorizationDTO"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransactionAuthorizationResDTO"
                }
              }
            }
          }
        }
      }
    },
    "/coinbridge/api/v2/transaction": {
      "post": {
        "summary": "Transaction Report",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TransactionReportDTO"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReportResDTO"
                }
              }
            }
          }
        }
      }
    },
    "/coinbridge/api/v2/refund": {
      "post": {
        "summary": "Refund Report",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RefundReportDTO"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReportResDTO"
                }
              }
            }
          }
        }
      }
    },
    "/coinbridge/api/v2/correction": {
      "post": {
        "summary": "Transaction Correction Report",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CorrectionReportDTO"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReportResDTO"
                }
              }
            }
          }
        }
      }
    },
    "/coinbridge/api/v2/user-event": {
      "post": {
        "summary": "User Event Notifications",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserEventDTO"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ReportResDTO"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "EndUserDetailsDTO": {
        "type": "object",
        "required": [
          "valid"
        ],
        "properties": {
          "valid": {
            "type": "boolean"
          },
          "personalId": {
            "type": "string"
          },
          "countryOfResidence": {
            "type": "string"
          }
        }
      },
      "EndUserBalanceDTO": {
        "type": "object",
        "required": [
          "amount",
          "currencyCode"
        ],
        "properties": {
          "amount": {
            "type": "number",
            "format": "float"
          },
          "currencyCode": {
            "type": "string"
          },
          "validUntil": {
            "type": "string"
          }
        }
      },
      "EndUserRulesDTO": {
        "type": "object",
        "required": [
          "rules"
        ],
        "properties": {
          "rules": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpendingRuleDTO"
            }
          }
        }
      },
      "SpendingRuleDTO": {
        "type": "object",
        "properties": {
          "allowOnlyMccCodes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "restrictMccCodes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "allowOnlyMerchantIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "restrictMerchantIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "allowOnlyCountryCodes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "restrictCountryCodes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "maxTransactionCardAmount": {
            "type": "number",
            "format": "float"
          },
          "minTransactionCardAmount": {
            "type": "number",
            "format": "float"
          }
        }
      },
      "TransactionAuthorizationDTO": {
        "type": "object",
        "required": [
          "reportId",
          "userId",
          "details"
        ],
        "properties": {
          "reportId": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "details": {
            "$ref": "#/components/schemas/TransactionDetailsDTO"
          }
        }
      },
      "TransactionAuthorizationResDTO": {
        "type": "object",
        "required": [
          "authId",
          "decision"
        ],
        "properties": {
          "authId": {
            "type": "string"
          },
          "decision": {
            "$ref": "#/components/schemas/AuthorizationDecisionDTO"
          }
        }
      },
      "AuthorizationDecisionDTO": {
        "type": "object",
        "required": [
          "approved"
        ],
        "properties": {
          "approved": {
            "type": "boolean"
          },
          "declineReason": {
            "type": "string"
          }
        }
      },
      "TransactionReportDTO": {
        "type": "object",
        "required": [
          "reportId",
          "userId",
          "eventTimestamp",
          "transaction"
        ],
        "properties": {
          "reportId": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "eventTimestamp": {
            "type": "string"
          },
          "transaction": {
            "$ref": "#/components/schemas/TransactionDTO"
          }
        }
      },
      "TransactionDTO": {
        "type": "object",
        "required": [
          "approved",
          "details"
        ],
        "properties": {
          "approved": {
            "type": "boolean"
          },
          "declineReason": {
            "$ref": "#/components/schemas/DeclineReason"
          },
          "declineDetails": {
            "type": "string"
          },
          "details": {
            "$ref": "#/components/schemas/TransactionDetailsDTO"
          }
        }
      },
      "TransactionDetailsDTO": {
        "type": "object",
        "required": [
          "id",
          "timestamp",
          "billingAmount",
          "billingCurrencyCode",
          "countryCode",
          "transactionAmount",
          "transactionCurrencyCode",
          "source",
          "merchant"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "timestamp": {
            "type": "string"
          },
          "billingAmount": {
            "type": "number",
            "format": "float"
          },
          "billingCurrencyCode": {
            "type": "string"
          },
          "countryCode": {
            "type": "string"
          },
          "transactionAmount": {
            "type": "number",
            "format": "float"
          },
          "transactionCurrencyCode": {
            "type": "string"
          },
          "authCode": {
            "type": "string"
          },
          "mccCode": {
            "type": "string"
          },
          "source": {
            "$ref": "#/components/schemas/TransactionSource"
          },
          "wallet": {
            "type": "string"
          },
          "merchant": {
            "$ref": "#/components/schemas/MerchantDTO"
          },
          "rrn": {
            "type": "string"
          }
        }
      },
      "MerchantDTO": {
        "type": "object",
        "required": [
          "id",
          "name"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "countryCode": {
            "type": "string"
          },
          "city": {
            "type": "string"
          },
          "region": {
            "type": "string"
          },
          "street": {
            "type": "string"
          },
          "tel": {
            "type": "string"
          },
          "nameOther": {
            "type": "string"
          },
          "contact": {
            "type": "string"
          }
        }
      },
      "ReportResDTO": {
        "type": "object",
        "properties": {
          "eventId": {
            "type": "string"
          }
        }
      },
      "RefundReportDTO": {
        "type": "object",
        "required": [
          "reportId",
          "userId",
          "eventTimestamp",
          "refundDetails"
        ],
        "properties": {
          "reportId": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "eventTimestamp": {
            "type": "string"
          },
          "originalTransactionId": {
            "type": "string"
          },
          "refundDetails": {
            "$ref": "#/components/schemas/TransactionDetailsDTO"
          }
        }
      },
      "CorrectionReportDTO": {
        "type": "object",
        "required": [
          "reportId",
          "userId",
          "eventTimestamp",
          "originalTransactionId",
          "correctionReason",
          "correctionAmount",
          "correctionCurrency",
          "originalTransactionDetails"
        ],
        "properties": {
          "reportId": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "eventTimestamp": {
            "type": "string"
          },
          "originalTransactionId": {
            "type": "string"
          },
          "correctionReason": {
            "$ref": "#/components/schemas/CorrectionReason"
          },
          "correctionAmount": {
            "type": "number",
            "format": "float"
          },
          "correctionCurrency": {
            "type": "string"
          },
          "originalTransactionDetails": {
            "$ref": "#/components/schemas/TransactionDetailsDTO"
          }
        }
      },
      "UserEventDTO": {
        "type": "object",
        "required": [
          "reportId",
          "userId",
          "eventType"
        ],
        "properties": {
          "reportId": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "eventType": {
            "$ref": "#/components/schemas/UserEventType"
          },
          "eventMetadata": {
            "type": "object"
          }
        }
      },
      "TransactionSource": {
        "type": "string",
        "enum": [
          "E_COMMERCE",
          "E_COMMERCE_WALLET",
          "WALLET",
          "PHYSICAL_CARD",
          "MANUAL_PAN",
          "OTHER",
          "UNKNOWN"
        ]
      },
      "DeclineReason": {
        "type": "string",
        "enum": [
          "INSUFFICIENT_END_USER_FUNDS",
          "INSUFFICIENT_APPLICATION_FUNDS",
          "MCC_NOT_ALLOWED",
          "MID_NOT_ALLOWED",
          "COUNTRY_NOT_ALLOWED",
          "AMOUNT_BELOW_THRESHOLD",
          "AMOUNT_EXCEEDS_THRESHOLD",
          "CB_PAYMENT_UNPREPARED",
          "CB_SYSTEM_ERROR",
          "INTEGRATION_ERROR"
        ]
      },
      "CorrectionReason": {
        "type": "string",
        "enum": [
          "TRANSACTION_CANCELLED",
          "SETTLEMENT_DIFF",
          "TRANSACTION_EXPIRED",
          "SETTLEMENT_POST_TRANSACTION_EXPIRATION"
        ]
      },
      "UserEventType": {
        "type": "string",
        "enum": [
          "APPLE_EMAIL_CARD_PROVISIONED",
          "APPLE_EMAIL_CARD_NOT_PROVISIONED",
          "APPLE_EMAIL_PROVISIONING_ABANDONED",
          "APPLE_EMAIL_USER_INACTIVE",
          "APPLE_EMAIL_OFFER_INCENTIVE",
          "USER_ELIGIBILITY_STATE_CHANGED",
          "CARD_ISSUED"
        ]
      }
    }
  }
}