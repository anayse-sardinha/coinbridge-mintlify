---
title: "How the CoinBridge Payment Process Works" 
---
CoinBridge offers sophisticated technology for converting digital assets into real-world currency, the core implementation process follows a consistent sequence. This guide provides a step-by-step breakdown of how the solution flows through the mobile SDK and webhooks.

### The CoinBridge Integration Process
The integration process consists of four primary phases:
- User Authentication & Eligibility 
- SDK Initialization 
- Payment Method Issuing 
- Provisioning & Payment Execution 

A successful integration leads to a seamless Tap & Go experience where digital assets are converted into usable currency at any shop worldwide.


### SDK Installation
Install the CoinBridge SDK in your application.

* **Android:** Minimum API level 26 (Android 8.0). Add the dependency to your `build.gradle` file.
* **iOS:** Minimum version 13.4. Use Swift Package Manager (SPM) to add the dependency.


### Step 1: User Authentication & Eligibility
1. Authenticate users using a JSON Web Token (JWT) generated by your backend.
- **Algorithm:** Use RS256 (RSA Signature with SHA-256).
- **Security:** Never generate or store private keys on the client side.

2. Ensure the user's unique ID is consistent across:

- Your mobile app
- Your webhooks
- The CoinBridge platform

3. Before enabling subscriptions, verify the user meets regulatory criteria (e.g., country of residence).
> **Important:** Store this unique ID. It is required for all subsequent SDK calls and backend communication.

### Step 2: SDK Initialization

Initialize the SDK only **after** successful authentication to determine the user’s current state.

**1. Call `init`**. It returns two key identifiers: `hasCard` (boolean) and `CBPaymentStatus` (object).

2. Use these values to route the user to the correct flow:

* **No Card** (`hasCard = false`): 
    Go to **Create a Card**.
* **Card Exists, No Wallet Token** (`hasCard = true` + `CBPaymentStatus` indicates no token): 
    Go to **Add to Wallet** (Apple Pay/Google Pay).
* **Fully Setup**: 
    User is ready to accept and process payments. Go to Webhooks. 

> **Tip:** Always check `CBPaymentStatus` even if `hasCard` is true, as a user might have a card but may have changed devices or deleted it from their digital wallet.

### Step 3: Create a Card

If the user does not have an active payment method (`hasCard = false`), you must create a virtual a card to define their funding source.

1. Use the `IssueCard` method to generate a virtual card for the user.

2. Depending on local regulations, you must collect:
* Information such as SSN or National ID.
* Agreement to terms and conditions via a dedicated form.

3. Real-time Assessment
During issuance, the webhook synchronizes with your loyalty platform to:
* Confirm available user funds.
* Validate spending and risk policies.

> **Note:** Successful issuance updates the `hasCard` status to `true`, allowing the user to proceed to wallet provisioning.

### Step 4: Wallet Provisioning (Push to Wallet)

To enable the "Tap & Go" experience, you must push the virtual card token into the device's secure mobile wallet.

1. Depending on the operating system, call the relevant method:

* **Android:** Call `provisionCard` to push the token to the Google Wallet via the SDK.
* **iOS:** Call `addToApplePay` to add the card to the user’s Apple Wallet (iPhone or Apple Watch).

2. Once complete, the `CBPaymentStatus` object (retrieved in Step 2) will reflect that a valid wallet token exists.

> **Note:** This step requires the app to have the correct Entitlements (iOS) or Play Services permissions (Android) configured in your project settings.

### Step 5: [iOS Only] "Pay Now" Button & Execution

For iOS integrations, you must implement the mandatory **Pay Now** button to trigger the payment interface.
> **Note:** Show the "Pay Now" button **only** after the card is successfully provisioned to the Apple Wallet.

**Payment Execution**
When the user taps the button:
* The SDK initiates the **NFC/EMV protocol**.
* The device communicates directly with the Point-of-Sale (POS) terminal.

**Real-Time Authorization**
Upon contact with the terminal:
1. CoinBridge instantly verifies the user’s loyalty balance.
2. Spending rules and risk checks are assessed in real-time.
3. The transaction is approved or declined based on these live criteria.

> **Important:** Ensure the "Pay Now" button adheres to Apple’s Human Interface Guidelines (HIG) for Apple Pay branding and placement.

### Step 6: Connect Webhooks
After a transaction, CoinBridge sends data back to your platform via the Transaction Report Endpoint. This allows you to update the user's balance and transaction history immediately.
